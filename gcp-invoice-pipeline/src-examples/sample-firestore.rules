rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Invoice metadata can only be read/written by authenticated services
    match /invoice_metadata/{invoiceId} {
      allow read, write: if request.auth.token.email_verified == true &&
                           request.auth.token.email.endsWith('@your-project.iam.gserviceaccount.com');
    }

    // Canonical vendor list is read-only for functions, writable only by admins
    match /canonical_vendors/{vendorId} {
      allow read: if request.auth.token.email_verified == true &&
                     request.auth.token.email.endsWith('@your-project.iam.gserviceaccount.com');
      allow write: if false; // Disallow direct writes from services
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
